### 1. 计算机网络概述

#### 计算机网络

![](/Users/limiao/personal/notebook/计算机网络/学_图片/计算机网络.png)

网络：许多计算机连接在一起
互联网：许多网络连接在一起
因特网：全球最大的一个互联网

ISP ：Internet 服务提供商(如移动、联通、电信等)

#### 因特网的组成

![](/Users/limiao/personal/notebook/计算机网络/学_图片/因特网的组成.png)

1. 边缘部分(主机之间的通信方式)
   客户服务器方式(client/server —c/s)
   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/客户端方式.png)

   对等方式(peer to peer — p2p)
   每一个计算机都可以是客户端也可以是服务端

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/对等方式.png)

2. 核心部分：能够让计算机通信的网络
   电路交换（circuit switching）：适合于数据量很大的实时性传输，核心路由器之间可以使用电路交换。会占线（如打电话）

   报文交换（message switching）：报文不分段，报文一般比分组长的多，报文交换的时延较长。

   分组交换（packet switching）：
   	发送端把报文数据分成几段，每一段都要在首部写入接收端和发送端的地址，接收端收到后把首页去掉，再按顺序连接起来，就是完整的数据了。选择最佳路径。优点：高效，灵活，迅速，可靠。缺点：时延，开销

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/分组交换-发送端.png)

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/分组交换-接收端.png)

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/分组交换-接收端1.png)

   

   **三种交换方式的对比**

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/三种交换方式的对比.png)



#### 计算机网络的类别

1. 局域网：应用局域网技术
   自己购买设备，自己维护，带宽固定，由设置决定，距离100米以内
   - 特点：网络为一个单位所拥有，且地理范围和站点数据均有限。
   - 优点：
     1. 具有广播功能，从一个站点可以很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
     2. 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
     3. 提高了系统的可靠性、可用性、生存性。
   
2. 广域网：应用广域网技术
   花钱买服务，买带宽

#### 计算机网络的性能

1. 速率：连接在计算机网络上的主机在数字信道上传送数据位数的速率，也称为 data rete 或 bit rate。单位是：b/s,kb/s,Mb/s,Gb/s。

2. 带宽：数据通信领域中，数字信道所传送的最高数据率。单位是：b/s,kb/s,Mb/s,Gb/s。

3. 吞吐量：单位时间内通过某个网络的数据量。单位：b/s,Mb/s 等。

4. 时延：发送时延 + 传播时延 + 处理时延  + 排队时延。
   发送时延 = 数据块长度(比特) / 信道带宽(比特/秒)
   传播时延 = 信道长度(米) / 信号在信道上的传播速率(米/秒)
   处理时延：网络结点(设备)存储转发处理的时间
   排队时延：网络结点缓存队列排队时间

5. 时延带宽积：数据链路上能够承载的最大数据量。
   时延带宽积 = 传播时延  \* 带宽

6. 往返时间：从发送方发送数据开始，到发送方收到接收方确认的时间。

7. 利用率：

   1. 信道利用率：有数据通过时间/ (有+无)数据通过时间

   2. 网络利用率：信道利用率加权平均值

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/网络利用率.png)



#### 计算机网络体系结构

1. 几个基本概念：
   **ISO:** 国际标准化组织
   **OSI/RM:**互联网法律上的国际标准
   **TCP/IP Suite：**因特网事实上的国际标准
   **Network Protocols：**数据交换遵守的规则、标准或约定
   **网络体系结构：**计算机网络各层及其协议的集合
2. OSI参考模型
   OSI 7层 从高到低
   应用层：能够产生流量，能和用户交互的应用程序
   表示层：加密，压缩，开发人员要考虑的一些问题
   会话层：服务和客户端建立的会话 ，可以用来查木马 netstat -nb
   传输层：可靠传输（建立会话），不可靠传输（不建立会话），流量控制
   网络层：ip 地址编址，选择最佳路径
   数据链路层：数据如何封装，添加物理层地址(mac 地址)
   物理层：电压，接口标准
   网络排错：从底层到高层
3. 网络安全和 OSI参考模型
   物理层安全
   数据链路层安全  ADSL ，AP
   网络层安全
   应用层安全  SQL注入漏洞 ， 上传漏洞
4. 开放系统信息交换涉及的几个概念
   实体（entity）：交换信息的硬件或软件进程
   协议(protocol)：控制两个对等实体通信的规则
   服务(service)：下层向上层提供服务，上层需要使用下层提供的服务来实现本层的功能
   服务访问点(sap)：相邻两层实体间交换信息的地方
5. 五层协议对应的数据单元
   应用层：传输数据单元 PDU(文档，文件等)
   传输层：传输层报文，添加首部
   网络层：IP 数据报(IP 分组) ，添加首部
   数据链路层：数据帧，添加首部，尾部
   物理层：01001101010  比特 ，转换成比特流



### 2. 物理层

#### 物理层的基本概念

物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体(如，光纤，电缆等)。

物理层的主要任务描述为：确定与传输媒体的接口的一些特性，即：

1. 机械特性：如，接口形状，大小，引线数目
2. 电气特性：如，规定电压范围(-5V到+5V)
3. 功能特性：如，规定-5V 表示0，+5V 表示1
4. 过程特性：也称干什么呢特性，规定建立连接时各个相关部件的工作步骤



#### 数据通信的基础知识

1. 相关术语

   1. 通信的目的是传送消息
   2. 数据(data) — 传送消息的实体
   3. 信号(signal) — 数据的电气的或电磁的表现
   4. "模拟信号" — 代表消息的参数的取值是连续的
   5. "数字信号" — 代表消息的参数的取值是离散的
   6. 码元(code) — 在使用时间域的波形表示数字信号时，则代表不同离散数值的基本波形就成为码元
      在数字通信中常常用时间间隔相同的符号业表示一个二进制的数字，这样的时间间隔内的信号称为二进制码元。而这个间隔被称为码元长度，1码元可以携带 nbit 的信息量

2. 信道相关的基本概念

   1. 信道— 信道一般表示向一个方向传送信息的媒体。平常说的通信线路往往包含一条发送信息的信道和一条接收信息的信道。
   2. 单向通信(单工通信) — 只能有一个方向的通信而没有反方向的交互
   3. 双向交替通信(半双工通信) — 通信的双方都可以发送信息，但不能双方同时发送(当然也不能同时接收)
   4. 双向同时通信(全双工通信) — 通信的双方可以同时发送和接收信息

3. 基带（baseband）信号和带通(basepass)信号

   1. 基带信号(即基本频带信号) —— 来自信源的信号，没有经过处理的。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传输的信息的信号，比如我们说话的声波就是基带信号
   2. 带通信号 — — 把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道）
      由于近距离范围内基带信号的衰减不大，从而信号内容不会发生变化。因此在传输距离较近时，计算机网络都采用基带传输方式。如从计算机到监视器、打印机等外设的信号就是基带传输的

4. 几种最基本的调制方法

   1. 调幅(AM)：载波的振幅随基带数字信号而变化
   2. 高频(FM)：载波的频率随基带数字信号而变化
   3. 调相(PM)：载波的初始相位随基带数字信号而变化

5. 常用编码

   1. 单极性不归零码 — 只使用一个电压值，用高电平表示1，没电压表示0
   2. 双极性不归零码 — 用正电平和负电平分别表示二进制数据的1和0，正负幅值相等
   3. 双极性归零码 — 正负零三个电平，信号本身携带同步信息
   4. 曼彻斯特编码 — bit 中间有信号低-高跳变为0，bit 中间有信号高-低跳变为1
      采用曼彻斯特编码，一个时钟周期只可表示一个 bit，并且必须通过两次采样才能得到一个 bit，但它能携带时钟信号，且可表示没有数据传输
   5. 差分曼彻斯特编码 — bit 中间有信号跳变，bit 与 bit 之间也有信号跳变，表示下一个 bit 为0，bit 中间有信号跳变，bit 与 bit 之间无信号跳变，表示下一个 bit 为1
      差分曼彻斯特编码与曼彻斯特编相同，但抗干扰性能强。

6. 奈氏准则和香农公式

   1. 奈氏准则 — 理想低通信意道的最高码元传输速率 = 2WBaud
      W：是理想低通信道的带宽，单位为 HZ
      Baud 是波特，是码元传输速率的单位

      在任何信道中，码元的传输速率是有上限值的，否则就会出现码间串扰的问题，使接收端对码元的判断(即识别)成为不可能
      如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以使用更高的速率传送码元而不出现码间串扰

   2. 波特与 bit 的区别
      波特：在调制解调器中经常用到波特这个概念
       bit：是信息量
      如果一个码元含有3个 bit 信息量，那么1波特=3 Bit/s

   3. 香农公式
      香农用信息论的理论推导出了带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率
      
      
      香农公式表明：
      
      信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。只要信息传输速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输。
      若信道带宽 W 或信噪比 S/N 没有上限(当然实际信道不可能是这样的)，则信道的极限信息传输速率 C 也就没有上限。实际信道上能够达到的信息传输速率要比香农的极限传输速率低不少。 
   
   7. 奈氏准则和香农公式的应用
      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/奈氏准则和香农公式的应用.png)

#### 物理层下面的传输媒体

1. 导向传输媒体 — 导向传输媒体中，电磁波沿着固体媒体传播

   1. 双绞线
      1. 屏蔽双绞线 STP
      2. 无屏蔽双绞线 UTP
   2. 同轴电缆
      1. 50 Ω 同轴电缆，用于数字传输，由于多用于基带传输，也叫基带同轴电缆
      2. 75 Ω 同轴电缆，用于模拟传输，即宽带同轴电缆
   3. 光缆   

2. 非导向传输媒体 — 非导向传输媒体是指自由空间，其中的电磁波传输被称为无线传输

   无线传输所使用的频段很广，短波通信主要是靠电离层的反射，但短波信道的通信质量较差。

   微波在空间主要是直线传播

   1. 地面微波接力通信
   2. 卫星通信



#### 信道复用技术

1. 频分复用 FDM(Frequency Division Multiplexing)
   用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带
   频分复用的所有用户在同样的时间占用不同的带宽资源(这里的带宽是频率带宽，而不是数据的发送速率)

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/频分复用1.png)


   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/频分复用2.png)

2. 时分复用 TDM(Time Division Multiplexing)

   时分复用是将时间划分为一段段等长的时分复用帧(TDM 帧)。
   每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。
   每一个用户所占用的时隙是周期性地出现(其周期就是 TDM帧的长度对应的时间)。
   TDM 信号也称为等时信号。
   时分复用的所有用户是在不同的时间占用同样的频带宽度。

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/时分复用.png)

   

   

3. 统计时分复用 STDM(Statistic TDM)
   在时分复用的基础上为每个数据加一个标记，按标记接收，收到后再把标记去年，可以解决时分复用的资源浪费。

4. 波分复用 WDM(Wave length Division Multiplexing)
   频段分复用的特例

5. 码分复用CDM(Code Division Multiplexing)  > 码分多址 CDMA (Code Division Multiplexing Access)
   各用户使用经过特殊挑选的不同的码型，因此彼此不会造成干扰。这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。
   每一个比特时间划分为 m 个短的间隔，称为码片(chip)。

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/码分复用.png)


   S 站发送的信号是1 的话，则按码片发送，如果是0 的话，则发送码片的返码。

   任何一个码片向量和该码片向量的格式化内积都是 1。

   任何一个码片向量和该码片反码的向量的格式化内积都是 -1。

   两个不同站的码片序列正交，就是向量 S 和 T 和格式化内积都是0。

   

#### 数字传输系统

脉码调制 PCM 体制最初是为了在电话局之间的中继上传送多路电话。
由于历史上的原因，PCM 有两个互不兼容的国际标准，即北美的 24 路PCM (简称为 T1)和欧洲的 30路 PCM(简称为 E1)。我国采用的是 E1标准。
E1的速率是2.048Mb/s，而 T1 的速率是1.544 Mb/s。
当需要有更高的数据率时，可采用复用的方法。

#### 宽带接入技术

1. xDSL (用数字技术对现有的模拟电话用户线进行改进)
2. 光纤同轴混合网 HFC (Hybrid Fiber Coax)
   HFC 网是在目前覆盖面很广的有线电视网 CATV 的基础上开发的一种居民宽带接入网。
3. FTTx 技术 (光纤到 xx)
   一种实现宽带居民接入网的方案。





### 3. 数据链路层

#### 数据链路层基本概念及基本问题

![](/Users/limiao/personal/notebook/计算机网络/学_图片/数据发送模型.png)



1. 数据链路层使用的信道主要有以下两种类型：

   1. 点对点 — 这种信道使用一对一的点对点通信方式
   2. 广播信道 — 这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

2. 链路与数据链路

   1. 链路是一条点到点的物理线路段，中间没有任何其他结点。
      一条链路只是一条通路的一个组成部分
   2. 数据链路除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件回到链路上，就构成了数据链路。
      - 现在最常用的方法是使用适配器(即网卡)来实现这些协议的硬件和软件
      - 一般的适配器都包括了数据链路层和物理层这两层的功能

3. 帧— 数据链路层传送的是帧

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/帧.png)

4. 三个基本问题

   1. 封装成帧 —  封装成帧(framing)就是在一段数据的前后段分别添加首部和尾部，然后就构成了一个帧，确定帧的界限

      首部和尾部的一个重要作用就是进行帧定界

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/封装成帧.png)

      

   2. 透明传输 —  若传输的数据是 ASCII 码中"可打印字符(共95个)"集时，一般没问题，但若传输的数据不是仅由"可打印字符"组成时，就会出现问题。

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/出现 EOT.png)

      ***用字节填充法解决透明传输的问题***

      发送端的数据链路层在数据中出现控制字符"SOH" 或 "EOT"的前面插入一个字符"ESC"(其十六进制编码是 1b)。
      字节填充或字符填充—— 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
      如果转义字符也出现在数据当中，那么应在转义字符前插入一个转义字符。当接收端收到连续的两个转义字符时，就删除其中前面的一个。

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/透明传输.png)

   3. 差错控制

      传输过程中可能会产生比特差错：1可能会变成0，0可能会变成1。
      在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER(Bit Error Rate)
      误码率与信噪比有很大的关系。
      为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。 

      ***循环冗余检验 CRC***

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/循环冗余法.png)

      

      - 101001 是要传输的二进制数据
      - 在后面添加 3 个0 
      - 选一个位数据大于在数据后面添加的位数(这里是3)所以选一个4位数做除数
      - 相同得1 ，不同得0
      - 当余数的位数与添加的位数相同时停止
      - 把余数添加到要传输的数据后面一起发送
      - 当接收端接收到数据时，再与之前的除数做除法，如果得到的余数为 0 ，则数据在传输过程中没有出错

#### 两种情况下的数据链路层(PPP ，广播)

1. 使用点对点（PPP 协议）信道的数据链路层 (广域网)

   ***PPP 协议***(Point to Point Protocol)

   现在全世界使用得最多的数据链路层协议。用户使用拨号电话线接入因特网时，一般都是使用 PPP 协议。

   **PPP  协议应该满足的要求：**

   - 简单 — 这是首要需求
   - 封装成帧
   - 透明性
   - 支持多种网络层协议
   - 支持多种类型链路
   - 差错检测
   - 检测连接状态
   - 最大传送单元 — 一般不超过1500字节
   - 网络层地址协商
   - 数据压缩协

   **PPP 协议的组成 **

   - 数据链路层协议可以用于异步串行或同步串行介质

   - 它使用 LCP(链路控制协议)建立并维护数据链路连接

   - 网络控制协议(NCP)允许在点到点连接上使用多种网络层协议

     ![](/Users/limiao/personal/notebook/计算机网络/学_图片/PPP 协议的组成.png)

     

   **PPP 协议的帧格式**

   ​	![](/Users/limiao/personal/notebook/计算机网络/学_图片/PPP协议帧格式.png)

   

   1. 标志字段 F ：0x7E (十六进制数，二进制为 01111110)
   2. 地址字段 A 只置为 0xFF。地址字段实际上并不起作用
   3. 控制字段 C 通常置为 0x03
   4. PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节

   **如何进行透明传输**

   1. 字节填充
   
      问题：信息字段中出现了标志字段的值，可能会被误认为是"标志字段怎么办？"
   
      - 将信息字段中出现的每个 0x7E 字节转变成为 2 个字节序列(0x7D, 0x5E)
      - 若信息字段中出现一个 0x7D 字节，则将其变成为 2 个字节序列(0x7D，0x5D)
      - 若信息字段中出现 ASCII  码的控制字符(即数值小于 0x20 的字符)，则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变
   
   2. 零比特填充
   
      PPP 协议用在 SONET/ SDH 链路时，是使用同步传输(一连串的比特连续传送)。这时 PPP 协议采用零比特填充方法来实现透明传输
      在发送端，只要发现有 5 个连续的 1，则立即填入一个 0，接收端对帧中的比特流进行扫描，每当发现 5 个连续的 1 时，就把这 5 个连续的 1 后面的一个 0 删除。
   
   **不使用序号和确认机制**
   
   1. 在数据链路层出现差错的概率不大时，使用比较简单的 PPP 协议较为合理
   2. 在因特网环境下，PPP 的信息字段放入的数据是 IP 数据报。数据链路层的可靠传输并不能够保证网络层的传输也是可靠的
   3. 帧检验序列 FCS 字段可保证无差错接受
   
   
   
   
   
   
   
   
   
   
   
   
   
2. 使用广播信道的数据链路层 (局域网 LAN)

   以太网(Ethernet) ：当今现有局域网采用的最通用的通信协议标准，当今现有局域网采用的最通用的通信协议
   
   1. 以太网的的特点
      总线上的一台计算机 A 发出的信号，线上的其他计算机都能检测到 A 发送的信号，由于只有 B 计算机的地址与数据帧首部写入的地址一致，因此只有 B 才能接收到这个数据帧。其他所有的计算机都检测到不是发送给他们的数据帧，因此就丢弃这个数据帧而不接收。具有广播特性的总上实现了一对一的通信。
   
   2. 以太网使用的协议— CSMA/CD 协议
   
       CSMA/CD 表示 Carrier Sense Multiple Access with Collision Detection。(载波监听多路访问及冲突检测)
      *多点接入* ：表示将许多计算机以多点接入的方式连接在一根总线上。
   
      *载波监听*：是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂不要发送数据，以免发生碰撞。
   
      *碰撞检测*  ： 就是计算机边发送数据边检测信道上的信号电压大小。
   
      - 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大(互相叠加)。
      - 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有个站同时在发送数据，表明产生了碰撞
      - 所谓"碰撞"就是发生了冲突，因此"碰撞检测"也称为"冲突检测"
      - 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来
      - 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后待一段随机时间后再次发送
   
      *电磁波在总线上的有限传播速率的影响*：
   
      - 当某个站监听到总线是空闲时，也可能总线并非是真正的空闲。
      - A 向 B发出的信息，要经过一定时间后才能传送到 B
      - B 若在 A 发送信息到达 B 之前发送自己的帧(因为这时 B 的载波监听检测不到 A 所发送的信息)，则必然要在某个时间和 A 发送的帧发生碰撞
      - 碰撞的结果是两个帧都变得无用
   
   
   
   



#### 以太局域网(以太网)

1. 以太网与数据链路层的两个子层

   1. 逻辑链路控制LLC(Logical Link Control)子层
   2. 媒体接入控制 MAC(Medium Access Control) 子层

   与接入到传输媒体有关的内容都放在 MAC 子层，而 LLC 子层则与传输媒体无关，不管采用体积协议的局域网对 LLC 子层来说都是透明的

   由于 TCP/IP 体系经常使用的局域网是 DIX Ethernet V2而不是802.3 标准中的几种局域网，因此现在 802 委员会制定的逻辑链路控制子层 LLC(即 802.2) 标准的作用已经不大了。很多厂商生产和适配器上就仅装有 MAC 协议而没有 LLC 协议。

2. 以太网提供的服务

   以太网提供的服务是不可靠的交付，即尽最大努力的交付。
   当接收站收到有差错的数据帧时就丢弃此帧，其他什么也不做，差错的纠正由高层来决定。
   如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帖，而是当作一个新的数据帧来发送。

3. 以太网的信道利用率

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/以太网的信道利用率.png)

   信道利用率的最大值

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/信道利用率的最大值.png)

   

   

4. 以太网的 MAC 地址
   在局域网中，硬件地址又称为物理地址，或 MAC 地址。MAC 地址实际上注是适配地址或适配器标识符 EUI-48。

   适配器检查 MAC 地址：

   - 适配器从网络上收到每一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址
   - 如果是发往本站的帧则收下，然后再进行其他的处理
   - 否则就将此帧丢弃，不再进行其他的处理
   - 发往本站的帧包括以下三种帧：
     1. 单播帧(一对一)
     2. 广播帧(一对全体)
     3. 多播帧(一对多)

5. 以太网帧格式

   > MAC 帧最短64个字节
   >
   > 以太网使用曼彻斯特编码，不需要结束标记

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/MAC帧格式.png)

   

   

   

#### 扩展以太网

1. 在物理层扩展
   主机使用光纤和一对光纤调制解调器连接到集线器

2. 在数据链路层扩展
   在数据链路层扩展局域网是使用 *网桥*
   网桥工作在数据链路层，它根据 MAC 帧的目的地址对收到的帧进行转发。
   网桥具有过滤帧的功能，当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口。

   使用网桥的优点：

   - 过滤通信量
   - 扩大物理范围
   - 提高了可靠性
   - 可互连不同物理层、不同 MAC 子层和不同速率的局域网

   使用网桥的缺点：

   - 存储转发增加了时延
   - 在 MAC 子层并没有流量控制功能
   - 具有不同 MAC 子层的网段桥接在一起时时延更大
   - 网桥只适合于用户数不多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴

   *透明网桥*：

   - 目前使用得最多的网桥是透明网桥(transparent bridge)。"透明"是指局域网上的站点并不知道所发送的帧将经过哪几个网桥，因为网桥对各站来说是看不见的。透明网桥是一种即插即用的设备，其标准是 IEEE 802.1D

   *自学习算法*

   按照以下自学习算法处理收到的帧和建立转发表

   - 若从 A 发出的帧从接口 x 进入了某网桥，那么从这个接口出发沿着相反方向一定可以把一个帧传送到 A
   - 网桥每收到一个帧，就记下其源地址和进入网桥的接口，作为转发表中的一个项目
   - 在建立转发表时是把帧首部的源地址写在"地址"这一栏的下面
   - 在转发帧时，则是根据收到的帧首部中的目的地址来转发的，这时就把在"地址"栏下面已经记下的源地址当作目的地址，而把记下的进入接口当作转发接口

   *使用交换机*

   - 交换机相当于升级版的网桥，接口更多，更安全

   *透明网桥使用了生成树算法，避免产生转发的帧在网络中不断的兜圈子*
   
3. 虚拟局域网

   虚拟局域网 VLAN是由一些局域网网段构成的与物理位置无关的逻辑组。

   - 这些网段具有某些共同的需求
   - 每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的工作站是属于哪一个 VLAN

   虚拟局域网只是局域网给用户提供的一种服务，而并不是一种新的局域网

   一个 VALN = 一个广播域 = 逻辑网段(子网)

   虚拟局域网是把交换机上的接口设置成几个不同的网段，每一个网段就是一个虚拟局域网。



#### 高速以太网

速率达到或超过 100 Mb/s 的以太网称为高速以太网。



### 4.网络层



#### 网络层提供的两种服务

网络层关注的是如何将分组从源端沿着网络路径送达目的端。

在计算机通信中，可靠交付由端系统负责。

网络层提供的两种服务：

1. 虚电路服务
   虚电路表示这只是一第逻辑上的连接，分组都沿着这务逻辑按照存储好的发送方式传送，而并不是真正建立了一条物理连接
   电路交换的电话通信是先建立了一条真正的连接。因此分组交换的虚连接和电路交换的连接只是类似，但并不完全一样。

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/虚电路.png)

   

   

2. 数据报服务

   网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。网络在发送分组时不需要先建立连接。每一个分组(即 IP 数据报)独立发送，与其前后的分组无关(不进行编号)。

   网络层不提供服务质量的承诺，即所传送的分组可能出错、丢失、重复和失序(不按序到达终点)，当然也不保证分组传送的时限。

   *尽最大努力交付的好处：*

   - 由于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉(与电信网的交换机相比)
   - 如果主机(即端系统)中的进程之间的通信需要可靠的，那么就由网络的主机中的运输层负责(包括差错处理、流量控制等)
   - 采用这种设计思路的好处是：网络的造价大降低，运行方式灵活，能够适应多种应用
   - 因特网能够发展到今日的规模，充分证明了当初采用这种设计思路的正确性


   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/数据报服务.png)



#### 网际协议 IP(RIP OSPF BGP)

1. 虚拟互联网
   中间设备又称为中间系统或中继系统

   - 物理层中继系统：转发器
   - 数据链路层中继系统：网桥或桥接器
   - 网络层中继系统：路由器
   - 网络层以上的中继系统：网关

   当中继系统是转发器或网桥时，一般并不称之为网络互连，因为这仅仅是把一个网络扩大了，而这仍然是一个网络。
   网关由于比较复杂，目前使用得较少

   互联网都是指用路由器进行互联的网络。

   由于历史原因，许多有关 TCP/ IP 的文献将网络层使用的路由器称为网关

   虚拟互联网的意义：

   - 所谓虚拟互联网也就是逻辑互连网络，它的意思就是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络。
   - 使用 IP 协议的虚拟互联网络可简称为 IP 网
   - 使用虚拟互联网络的好处是：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节

   *IP 协议简介*

   网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一，与 IP 协议配套使用的还有四个协议：

   - 地址解析协议 ARP(Address Resolution Protocol)
   - 逆地址解析协议 RARP(Reverse Adderss Resolution Protocol)
   - 网际控制报文协议 ICMP(Internet Control Message Protocol)
   - 网际组管理协议 IGMP(Internet Group Management Protocol)

   网络层四个协议之间的层次：

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/IPV4协议栈.png)

   

   

2. IP 地址

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/二进制和十进制.png)


   分类 IP 地址

   - 每一类地址都由两个固定长度的字段组成，其中一个字段是网络号(net-id)，它标志主机(或路由器)所连接到的网络，而另一个字段则是主机号(host-id)，它标志该主机(或路由器)
   - 主机部分不能全为0也不能全为1

   IP 地址中的网络字段和主机字段：

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/IP地址中的网络字段和主机字段.png)

   

   *特殊的几个地址*

   - 127.0.0.1 本地环回地址
   - 169.254.0.0  Windows 在 ip 地址不够用的时临时分配的地址
   - 保留的私网地址(外网访问不了)
     10.0.0.0
     172.168.0.0 ——— 172.31.0.0
     192.168.0.0 ——— 192.168.255.0 

   *子网掩码的作用：*

   - 保留IP 地址的网络部分，主机部分归零，判断该 IP 与通信的 IP 是否是在同一个网段中。

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/子网掩码的作用.png)

   

3. 划分子网和构造超网
   计算机比较少时，一个网段中的主机地址太多的话有浪费，所以把他们分成几个子网。

   *子网划分*

   1. 等分在两个子网
      子网掩码右 移一位，等分成两个子网
       ![](/Users/limiao/personal/notebook/计算机网络/学_图片/等分成两个子网.png)

      分成两个子网后的地址分配

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/分成两个子网后的地址分配.png)

      

   2. 等分成四个子网

      把子网掩码右移两位


      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/等分成四个子网.png)


​      

   3. 等分成八个子网
      把子网掩码右移三位

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/等分成八个子网.png)

   4. 点到点的子网掩码为 255.255.255.252

   5. 变长子网划分
      依次除2 ，与等长划分类似
      
         *超网*：把两个网段合并成一个网段
      
         子网掩码左移一位，合并两个网段
      
         ![](/Users/limiao/personal/notebook/计算机网络/学_图片/合并网段.png)

   

   

   				合并网络的规律

   			![](/Users/limiao/personal/notebook/计算机网络/学_图片/合并网络的规律.png)

   

4. IP 址与 MAC 硬件地址

   1. 两台计算机之间的通信

      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/两台计算机之间的通信.png)

   2. ARP 协议 — 根据 IP 地址获取 MAC 地址

      不管网络层使用的时什么协议，在实际网络的链路上传送数据时，最终还是必须使用硬件地址
      每一个主机都设有一个 ARP 高速缓存，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。
      当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址

   3. ARP 高速缓存的作用

      为了减少网络上的通信量，主机 A 在发送其 ARP 请求分组时，就将自己的 IP 地址到硬件地址的映射写入 ARP 请求分组。
   当主机 B 收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
   
   ARP 是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器 的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。
      从 IP 地址到硬件地址的解析是行动进行的，主机的用户对这种地址解析过程是不知道的。
   只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的硬件地址。
   
   4. 逆向地址解析协议 RARP
       逆向地址解析协议 ARAR 使用只知道自己硬件地址的主能够知道其 IP 地址。
   
   
   
   
   
5. IP 数据报格式

   1. 一个IP 数据报由首部和数据两部分组成

      - 首部的前一部分是固定长度，共 20 个字节，是所有 IP 数据报必须具有的
      - 在首部的固定部分的后面是一些可选字段，其长度是可变的

   2. IP 数据的格式
      ![](/Users/limiao/personal/notebook/计算机网络/学_图片/IP数据报格式.png)

      

      - 版本：占4位，指 IP 协议的版本，目前的 IP 协议版本号为4(即 IPV4)

      - 首部长度：占4位，可表示的最大数值是15个单位(一个单位为4字节)因此 IP 首部长度的最大值是60字节

      - 区分服务：占8位，用来获得更好的服务，在旧标准中叫做服务类型，但实际上一址未被使用过。1988年这个字段改名为区分服务，只有在使用区分服务时，这个字段才起作用， 在一般的情况一都不使用这个字段 Qos 服务质量

      - 总长度：占16位，指首部的数据之和的长度，单位为字节，因此数据报的最大长度为65535字节，总长度必须不超过最在传输单元 MTU

      - 标识：占16位，这是一个计数器，用来产生数据报的标识，不是序号，每产生一个数据包，就增加1

      - 标志：占3位，目前只有前两位有意义。标志字段的最低位是 MF(More Fragment)。MF = 1表示后面还有"分片"。MF = 0表示最后一个"分片"。标志字段中间的一位是 DF(don't Fragment)。只有当 DF=0时才允许分片。

      - 片偏移：13位，指出较长的分组在分片后某片在原分组中相对位置。片偏移以8个字节为偏移单位

        ![](/Users/limiao/personal/notebook/计算机网络/学_图片/IP 数据报偏移.png)

      - 生存时间 TTL(Time To Live) ：8位，数据报在网络块中可通过的路由器数的最大值

      - 协议：8位，指出此数据报携带的数据使用何种协议以便目的主机的 IP 层将数据部分上交给哪个进程

      - 首部校验和：16位，只检验数据报的首部，不检验数据部分，这里采用 CRC 检测码，而采用简单的计算方法

      - 源地址和目标地址各占4字节(ip 地址)

      - 可变部分：

        - IP首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富
        - 选项字段的长度可变，从1 个字节到40个字节不等，取决于所选择的项目
        - 增加首部的可变部分是为了增加 IP 数据报的功能，但这同时也使得 IP 数据报的首部长度成为可变的，这就增加了每一个路由器处理数据报的开销，实际上这些选项很少被使用

   3. 数据路由 — 路由器在不同网段发送数据包
      网络畅通的条件— 能去能回，沿途的路由器必须知道目标网络下一跳给哪个接口

   4. 静态路由 — Windows 的网关就是默认路由

   5. 网络负载均衡
      

6. IP 转发分组的流程(子网划分那一部分里)



#### 网际控制报文协议 ICMP

为了提高 IP 数据报交付成功的机会，在网际层使用了网际控制报文协议 ICMP(Internet Control Message Protocol)
ICMP 允许主机或路由器报告差错和提供有关异常情况的报告。
ICMP 不是高层协议，而是 IP 层协议
 ICMP 报文作为 IP 层数据报的数据，加上数据报的首部，组成 IP 数据报发送出去

1. ICMP 报文格式

   ![](/Users/limiao/personal/notebook/计算机网络/学_图片/ICMP 报文格式.png)

2. ICMP 报文的类型(排错 ping)

   - ICMP 报文的种类有两种，即 ICMP 差错报告报文和 ICMP 询问报文
   - ICMP 报文的前四个字节是统一的格式，共有三个字段：类型、代码、检验和。接着的4个字节的内容与 ICMP 的类型有关
   - 差错报告报文有五种：终点可达、源点抑制、时间超过、参数问题、改变路由(重定向)
   - 询问报文有两种：回送请求和回答报文，时间戳请求和回答报文 
   
3. 动态路由协议(选择最佳路径)

   1. RIP 协议 —  根据通过的路由器数据量选择，周期性的广播 

   2.  内部网关协议 OSPF(Open Shortest Path First)  — 根据带宽选择最佳路径

      - 向本自治系统中所有路由器发送信息，这里使用的方法是洪泛法
      - 发送的信息就是与本路由器相信的所有的路由器的链路状态，但这只是路由器所知道的部分信息
      - 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息

   3. 外部网关协议 BGP 

      - BGP 是不同自治系统的路由器之间交换路由信息的协议，BGP 较新版本是 BGP-4
      - 边界网关协议 BGP 只能是力求寻找一条能够到达目的的网络且比较好的路由(不能兜圈子)，而并非要寻找一条最佳路由
      - 每一个自治系统的管理员要选择至少一个路由器作为该自治系统的"BGP发言人"

   4. VPN 连接

   5. 网络地址转换 NAT (Network Address Translation)

      需要在专用网连接到因特网的路由器上安装 NAT 软件，装有 NAT 软件的路由器叫做 NAT 路由器，它至少有一个有效的外部全球地址 IP。所有使用本地地址的主机在和外界通信时都要在 NAT 路由器上将其本地地址转换成 IP 才能和因特网连接

   6. NAT 端口映射







#### 因特网的路由选择协议(选择最佳路线)

1. RIP 协议 —  根据通过的路由器数据量选择，周期性的广播 

2.  内部网关协议 OSPF(Open Shortest Path First)  — 根据带宽选择最佳路径

   - 向本自治系统中所有路由器发送信息，这里使用的方法是洪泛法
   - 发送的信息就是与本路由器相信的所有的路由器的链路状态，但这只是路由器所知道的部分信息
   - 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息



3. 外部网关协议 BGP 
   
   - BGP 是不同自治系统的路由器之间交换路由信息的协议，BGP 较新版本是 BGP-4

   - 边界网关协议 BGP 只能是力求寻找一条能够到达目的的网络且比较好的路由(不能兜圈子)，而并非要寻找一条最佳路由
   - 每一个自治系统的管理员要选择至少一个路由器作为该自治系统的"BGP发言人"
   
4. VPN 连接：在其他地方也可以访问指定的内网
   
5. 网络地址转换 NAT (Network Address Translation)
   
      需要在专用网连接到因特网的路由器上安装 NAT 软件，装有 NAT 软件的路由器叫做 NAT 路由器，它至少有一个有效的外部全球地址 IP。所有使用本地地址的主机在和外界通信时都要在 NAT 路由器上将其本地地址转换成 IP 才能和因特网连接
   
6. NAT 端口映射：把源端口用其他的指定的端口替换,允许Internet 上的计算机访问企业内网





#### IP 多播(组播)







#### 虚拟专用网 VPN 和网络地址转换 NAT









### 5. 传输层

TCP(可靠传输) — 分段、编号、流量控制、建立会话
UDP(不可靠传输) — 一个数据包就能完成数据通信 、不建立会话、多播

#### 传输层和应用层的之间的关系
http = TCP+80
https = TCP +443
ftp=TCP+21
SMTP = TCP +25
POP3 = TCP+110
RDP=TCP+3389
共享文件夹=TCP+445
SQL=TCP+1433

#### 应用层协议和服务之间的关系
​	服务运行后在 TCP 或 UDP 的某个端口侦听客户端请求

>  防火墙不能拦截木马程序

windons IPSec 控制流量



传输层协议和网络层协议的主要区别

- IP 协议的作用范围是提供主机之间的逻辑通信
- TCP 和 UDP 协议的作用范围是提供进程之间的逻辑通信

传输层的主要功能：

- 为应用进程之间提供端到端的逻辑通信(但网络层是为主机之间提供逻辑通信)
- 传输层还要对收到的报文进行差错检测
- 传输层提供面向连接和无连接的服务

#### TCP 与 UDP 

- UDP在传输数据之前不需要先建立连接。对方的运输层在收到 UDP 报文后，不需要给出任何确认，虽然 UDP 不提供可靠交付，但在某些情况下 UDP 是一种最有效的工作方式
- TCP 则提供面向连接的服务。TCP 不提供广播可多播服务。由于 TCP 要提供可靠的、面向连接的运输服务，因此不可避免地增加了许多的开销。这不仅使协议数据单元的首部增大很多，还要占用许多的处理机资源 

#### TCP 协议的概述

1. tcp 是面向连接的传输层协议

2. 每条 tcp 连接只能有两个端点(endpoing)，每一条 tcp 连接只能是点对点的(一对一)

   tcp 把连接作为最基本的抽象
   每一条 tcp 连接都有两个端点
   tcp 连接的端点不是主机，不是主机的 ip 地址，不是应用进程，也不是传输层的协议端口。
   tcp 连接的端点叫做 ***套接字（socket）*** 
   端口号拼接到 ip 地址即构成了套接字。

3. tcp 提供可靠的交付服务

4. tcp 提供全双工通信(发送端和接收端都在不断的相互响应)

5. 面向字节流(视频：p111)

   

#### TCP 协议的特点  

1. TCP 如何实现可靠传输

   ***可靠传输的工作原理———停止等待协议***

   ​	无差错情况：

   1. 发送端等待接收端的确认信息
   2. 发送端收到确认后发送后面的数据

   ​     超时重传：

   1. 发送端没有收到接收端的确认消息
   2. 等一会重新传数据

   ​     确认丢失：

   1. 接收端的确认信息在传输的过程中丢失了，发送端没有收到
   2. 超时重传

   ​     确认迟到：

   1. 在一断时间没有收到确认信息，重传
   2. 在后面再接收到确认消息时不做处理

   

   使用上述的确认和重传机制，我们就可以在不可靠的传输网络上实现可靠的通信。

   这种可靠传输协议常称为**自动重传请求 ARQ(Automatic Repeat reQuest)**

   ARQ 表明重传是请求是自动进行的，接收方不需要请求方发送重传某个出错的分组。

   停止等待协议的优点是简单，但缺点是信道利用率太低。
   提高信道利用率：

   ***流水线传输***

   发送方可连续发送多个分组，不必每发完一个分组就停下来等待对方的确认信息。由于信道上一直有数据不间断的传送，这种传输方式可获得很高的信道利用率。

   ***连续 ARQ 协议（流水线）***

   发送方维持发送窗口(比如是5)
   每收到一个确认信息，窗口就向后移一位，后面进入到发送窗口的数据组开始发送。

   ***累积确认（流水线）***

   当发送方收到第 n 个组的确认信息后，第 n 个之前的确认信息就不用再发了。

   

2. TCP 协议如何实现流量控制

   TCP 首部报文
   ![tcp 首部报文](/Users/limiao/personal/notebook/计算机网络/学_图片/tcp 首部报文.jpeg)

   **URG**：当 URG =1 时，表示发送的是紧急报文，在发送端的缓存区不排队等待，当当前数据报文发送完毕后立即发送该报文。

   **ACK** ：表示前面的确认号字段是否有效。ACK=1，表示前面的确认号字段有效。也就表示该 tcp 会话建立成功。

   **PSH**：告诉对方收到该报文后是否应该立即推送给上层。当 PSH=1时，表示对方接收到报文时，在缓存区不等待，直接接收。

   **RST**：当 RST=1时，说明你与主机的连接出现了严重的错误，必须释放连接，然后再重新建立连接。或者说明你上次发送给主机的数据有问题，主机拒绝响应。

   **SYN**：在建立连接时用来同步序列号。当 SYN=1 ACK=0时，表示这是一个请求建立连接的报文，当 SYN=1 ACK =1时，表示对方同意建立连接，当 SYN=1时，表示这是一个建立连接的请求或同意建立连接的请求。只有在前两次握手中 SYN 才会设置为1。

   **FIN**：标记数据是否发送完毕。当 FIN=1时，相当于告诉对方：我的数据已经发送完毕，你可以释放连接了。
   **数据窗口**：表示可以接收的数据量，发送方根据该设置自己数据的发送量。

   **校验和**：计算时与 UDP 类似。

   **紧急指针**：指向紧急数据的最后一个字节的位置。

   **选项部分**：

   选项部分的应用：
   **MSS最大报文段长度(Maxium Segment Size)**：指明数据字段的最大长度，数据字段的长度加上TCP首部的长度才等于整个TCP报文段的长度。MSS值指示自己期望对方发送TCP报文段时那个数据字段的长度。通信双方可以有不同的MSS值。如果未填写，默认采用536字节。MSS只出现在SYN报文中。即：MSS出现在SYN=1的报文段中。
   窗口扩大选项(Windows Scaling)：由于TCP首部的窗口大小字段长度是16位，所以其表示的最大数是65535。但是随着时延和带宽比较大的通信产生（如卫星通信），需要更大的窗口来满足性能和吞吐率，所以产生了这个窗口扩大选项。

   **SACK选择确认项(Selective Acknowledgements)**：用来确保只重传缺少的报文段，而不是重传所有报文段。比如主机A发送报文段1、2、3，而主机B仅收到报文段1、3。那么此时就需要使用SACK选项来告诉发送方只发送丢失的数据。那么又如何指明丢失了哪些报文段呢？使用SACK需要两个功能字节。一个表示要使用SACK选项，另一个指明这个选项占用多少字节。描述丢失的报文段2，是通过描述它的左右边界报文段1、3来完成的。而这个1、3实际上是表示序列号，所以描述一个丢失的报文段需要64位即8个字节的空间。那么可以推算整个选项字段最多描述(40-2)/8=4个丢失的报文段。

   **时间戳选项（Timestamps）**：可以用来计算RTT(往返时间)，发送方发送TCP报文时，把当前的时间值放入时间戳字段，接收方收到后发送确认报文时，把这个时间戳字段的值复制到确认报文中，当发送方收到确认报文后即可计算出RTT。也可以用来防止回绕序号PAWS，也可以说可以用来区分相同序列号的不同报文。因为序列号用32为表示，每2^32个序列号就会产生回绕，那么使用时间戳字段就很容易区分相同序列号的不同报文。

   **NOP(NO-Operation)**：它要求选项部分中的每种选项长度必须是4字节的倍数，不足的则用NOP填充。同时也可以用来分割不同的选项字段。如窗口扩大选项和SACK之间用NOP隔开。

   

3. TCP 协议如何避免网络堵塞
   TCP 的流量控制———在给定的发送端和接收端之间的点对点通信量的控制，它所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。


   TCP 的拥塞控制-------拥塞控制是一个全局性的过程，涉及到所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素

   - 出现拥塞的条件：对资源需求的总和 > 可用资源

   - 慢开始和拥塞避免

     发送方维持拥塞窗口
     发送方控制拥塞窗口的原则是：

     1. 只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去
     2. 只要网络出现拥塞，拥塞窗口就减小一些，以减少注入到网络中的分组数

     拥塞避免是说在拥塞避免阶段把拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞。

     "拥塞避免"并非完全能够避免拥塞。

   - 快重传和快恢复

     快重传算法首先要求接收方每收到一个失序的报文段后就立即发出重复确认。这样做可以让发送方及早知道有报文段没有到达接收方。

     当发送端收到连续三个重复的确认时，就执行"乘法减小"算法，把慢开始门限 ssthresh 减半，但拥塞补钙品 cwnd 现在不设置为1，而是设置为慢开始门限 ssthresh 减半后的数值，然后开始执行拥塞避免算法(加法增大)，使用拥塞窗口缓慢地线性增大。

     

4. TCP 传输连接管理
   传输连接有三个阶段：连接建立，数据传送，连接释放
    TCP 连接的建立都是采用客户服务器方式
   主动发起连接建立的应用进程叫做客户端
   被动等待连接建立的应用进程叫做服务器

   建立连接：三次握手

   ![tcp建立连接的状态](/Users/limiao/personal/notebook/计算机网络/学_图片/TCP 建立连接的状态.png)

   ​	

   连接释放：四次挥手

   1. 数据传输结束后，通信的双方都可释放连接。客户端应用进程先向其 TCP 发出连接释放报文段，并停止再发送数据，主动关闭 TCP 连接。
   2. 客户端把连接释放报文段首部的 FIN=1，其序列号 seq=u，等待服务器的确认。
   3. 服务器发出确认，确认号 ack=u+1，而这个报文段自己的序列号 seq=v，TCP 服务器进程通知高层应用进程，从客户端到服务器这个方向的连接就释放了，TCP 连接处于半关闭状态。服务器发送数据，客户端仍会接收。
   4. 若服务器没有要向客户端发送的数据，其应用进程就通知 TCP 释放连接。
   5. 客户端收到连接释放报文段后，必须发送确认
   6. TCP 连接必须经过时间 2msl 后才真正释放掉。
   
   
      ![TCP 释放连接状态](/Users/limiao/personal/notebook/计算机网络/学_图片/TCP 释放连接状态.png)



### 6. 应用层



#### 1. 域名系统 DNS(Domain Name System)

DNS 服务的作用：解析域名，把域名解析成  IP 地址的主机能够正常获取 IP , DNS , 网关等。

DNS 的解析过程

![DNS 的解析过程](/Users/limiao/personal/notebook/计算机网络/学_图片/DNS 的解析过程.png)



安装自己的 DNS 服务器的三种场景：

1. 解析内网自己的域名
2. 降低到 internet 的域名解析流量
3. 域环境

*解析时提示*  Non-authritative answer,表示这个域名不是该 DNS 服务器直接管理的，而是从其他 DNS服务器上找来的。

#### 2. 动态主机配置协议 DHCP

DHCP 服务器用来给其他设备分配 IP，便于自动获取 IP 地址

静态 IP 地址:当电脑的位置固定时，一般用静态 ip，或是服务器用静态 ip，可以通过地址访问。

动态 IP 地址：电脑的位置经常变动，ip 要经常改变，用动态 ip。

**DHCP 客户端请求 IP 地址的过程：**

计算机设置自动获取 IP 地址后，就会变成一个DHCP 客户端，向网络上发送广播请求地址，这个广播的目标 ip 是 255.255.255.255,mac 地址是 FF（16进制），这个广播会传到所有的DHCP 服务器上，这些 DHCP 服务器接收到广播后都会从自己的 ip 池中选出一个 ip 址分配给客户端，客户端选择一个接收，DHCP服务器确定客户端接收了自己的 ip 地址后，再把网关、子网掩码等信息发送给客户端，其他的 DHCP 服务器确定没有接收自己的 ip 地址后，就把这个 ip 地址回收，再分配。

DHCP 服务器必须为静态地址

**DHCP跨网段分配 ip 地址**

![tcp建立连接的状态](/Users/limiao/personal/notebook/计算机网络/学_图片/DHCP 跨网段分配ip 地址.png)



#### 3. 文件传送协议 FTP(File Transfer Protocol)

**FTP 连接方式**

1. 控制连接：标准端口为21，用于发送 FTP 命令信息
2. 数据连接：标准端口为20，用于上传、下载数据
3. 数据连接的建立类型：
   1. 主动模式：服务端从20端口主支向客户端发起连接，FTP 客户端告诉 FTP 服务端使用什么端口侦听，FTP 服务器和 FTP 客户端的这个端口建立连接，源端口 20
   2. 被动模式：服务端在指定范围内的某个端口被动等待客户端发起连接

**FTP 传输模式**

1. 文本模式：ASCII 模式，以文本序列传输数据
2. 二进制模式：Binary 模式，以二进制序列传输数据

*FTP 服务器端如果有防火墙，需要在防火墙开21和20端口，使用主动模式进行数据连接*

#### 4. 远程终端协议 TELNET

默认使用 TCP 23 端口

远程控制其他设置(计算机，路由器等)

#### 5. 远程桌面 RDP

主要是操作

#### 6. 万维网 WWW(World Wide Web)

安装 web 服务 创建 web 站点

网站的标识： 不同的端口 ，不同的 ip 地址  ，使用主机头(域名)

Web 代理服务器：

1. 节省内网的流量带宽
2. 绕过防火墙

#### 7. 电子邮件(SMTP(发), POP3(收) , IMAP(收))

邮件的收发流程

![DNS 的解析过程](/Users/limiao/personal/notebook/计算机网络/学_图片/邮件的收发流程.png)





### 7.网络安全

#### 安全包括哪些方面：

1. 数据存储安全
2. 应用程序安全
3. 操作系统安全
4. 网络安全
5. 物理安全
6. 用户安全教育

#### 计算机网络上的通信面临的四种威胁

1. 截获 — 从网络上窃听他人的通信内容 — 被动攻击

2. 中断— 有意中断他人在网络上的通信 — 主动攻击

3. 篡改— 故意篡改网络上传送的报文 — 主动攻击

4. 伪造— 伪造信息在网络上传送 — 主动攻击

   

#### 计算机机的威胁 —— 恶意程序(rogue program)

1. 计算机病毒：会传染其他程序和程序，传染是通过修改其他程序来把自身或其变种复制进去完成的。能更改系统的设置，更改应用程序，删除文件。
2. 计算机蠕虫：通过网络的通信功能将自身从一个结点发送到另一个结点并启动运行的程序。 消耗系统资源，cpu ，内存，一点点消耗，计算机越来越慢，重启后又重新开始。
3. 木马：一种程序，它执行的功能超出所声称的功能。与外界通信。
   1. 查看会话— netstat -n 查看是否有可疑的会话
   2. 运行 msconfig 服务  隐藏微软服务
   3. 安装杀毒软件
4. 逻辑炸弹：一种当运行环境满足某种特定条件时执行其他特殊功能的程序。

#### 加密技术

加密算法，加密密钥

**对称加密**
优点：效率高
缺点：密钥不合适在网上传输，密钥维护麻烦

数据加密标准 DES 

数据加密标准 DES 属于常规密钥密码体制，是一种分组密码。在加密前，先结整个明文进行分组，每一个组长为64位。然后对每一个64位的二进制数据进行加密处理，产生一组64位密文数据。最后将各组官方串起来，即得出整个密文。使用的密钥为64伴(实际密钥长度为56位，有8位用于奇偶校验)

 DES 保密性仅取决于对密钥的保密，而算法是公开的。尽管人们在破译 DES 方面取得了许多进展，但至今仍未能找到比穷举搜索密钥要有效的方法。

DES 是世界上第一个公认的实用密码算法标准，它曾对密码学的发展做出了重大贡献。

目前较为严重的问题是 DES 的密钥的长度，现在已经设计出来搜索 DES 密钥的专用芯片。

DES 算法公开取决于密钥长度， 56位密钥破解需要3.5或21分钟，128位密钥破解需要5.4*10 的18次方年。

**非对称加密**

加密密钥和解密密钥是不同的
公钥加密私钥解密
私钥加密公钥解密

非对称加密的细节：
	用对称加密为文件内容加密，把对称加密的密钥用非对称加密的公钥加密。

数字签名：防止抵赖，能够检查签名之后的内容是否被更改

数字签名的使用：

![DNS 的解析过程](/Users/limiao/personal/notebook/计算机网络/学_图片/数字签名的使用.png)



数字证书：证书颁发机构确定。
证书颁发机构的作用：为企业和用户颁发数字证书，确认这些企业和个人的身份，发布证书吊销列表，企业和个人信任证书颁发机构。

#### 安全套接字 SSL 

SSL 是加在应用层和传输层之间的一层。

在发送方，SSL 接收应用层的数据(如 http 或 imap 报文)，对数据进行加密，然后把加了密的数据送往 TCP 套接字。 在接收方，SSL 从 TCP 套接字读取数据，解密后把数据交给应用层。

使用非对称加密。https 使用 TCP 443端口

 SSL 提供的三个功能：

1. SSL 服务器鉴别：
   允许用户证实服务器的身份，具有 SSL 功能的浏览器维持一个表，上面有一些可信赖的认证中心 CA(certificate authority)和它们的公钥
2. 加密的 SSL 会话：
   客户和服务器交互的所有数据都在发送方加密，在接收方解密
3. SSL 客户端鉴别：
   允许服务器证实客户端的身份



#### 网络层安全—— IPSec

网络层安全：
	在网络层加密，出网卡时加密或签名，在接收端的网络层进行解密，再传给应用层，不用在应用层做任何处理。



**安全关联SA(Secruity Association)**

在使用 AH 或 ESP 之前，先要从源主机到目的主机建立一条网络层的逻辑连接。此逻辑连接叫做安全关联 SA 。

IPSec 就把传统的因特网无连接的网络层转为具有逻辑连接的层。

SA(安全关联)是构成 IPSec 的基础，是两个通信实体经协商(利用 IKE 协议)建立起来的一种协定，它决定了用来保护数据分组安全的安全协议(AH 协议或 ESP 协议)、转码方式、密钥及密钥的有效存在时间等。

**IPSec 中最主要的协议**

1. 鉴别首部 AH (Authentication Header)：
   AH 鉴别源点和检查数据完整性，但不能保密(只签名)
   在使用鉴别首部协议 AH 时，把 AH 首部插在原数据部分的前面，同时把 IP 首部中的协议字段设置为 51。
   在传输过程中，中间的路由器都不查看 AH 首部。当数据报到达终点时，目的主机才会处理 AH 字段，以鉴别源点和检查数据报的完整性。
   ![DNS 的解析过程](/Users/limiao/personal/notebook/计算机网络/学_图片/AH 协议.png)

1. 封装安全有效载荷 ESP(Encapsulation Security Payload)：

   ESP 比 AH 复杂的多，它鉴别源点、检查数据完整性和提供保密(签名，加密)
   使用 ESP 时，IP 数据报首部的协议字段设置为 50，当 IP 首部检查到协议字段是 50时，就知道在 IP 首部后面紧接着的是 ESP 首部，同时在原 IP 数据报后面增加了两个字段，即ESP 尾部和 ESP 数据。

   ![DNS 的解析过程](/Users/limiao/personal/notebook/计算机网络/学_图片/ESP 协议.png)





#### 数据链路层安全

数据链路层安全一般指的线路上的安全。(路由器与路由器之间的链路加密，路由器端口进行加密解密，每一段链路都使用不同的密钥加密)

数据链路层实现身份验证(如：PPP 、ADSL)



#### 防火墙(firewall)

防火墙是由软件、硬件构成的系统，是一种特殊编程的路由器，用来在两个网络之间实施接入控制策略。接入控制策略是由使用防火墙的单位自行制定的，为的是可以最适合本单位的需要。

防火墙内的网络称为"可信赖的网络"，而将外部的因特网称为防火墙可用来解决内联网和外联网的安全问题。

**防火墙的种类**：

1. 网络级防火墙：
   用来防止整个网络出现外来非法入侵。属于这类的有分组过滤和授权服务器。前者检查所有流入本网络的信息，然后拒绝不符合事先制定好的一套准则数据，而后者则是检查用户的登录是否合法。
2. 应用级防火墙：
   从应用程序来进行接入控制。通常使用应用网关或代理服务器来区分各种应用。例如，可以只允许通过访问万维网的应用，而阻止 FTP 应用的通过。

**防火墙网络拓扑**：

1. 三像外围网
2. 背靠背防火墙
3. 单一网卡
4. 边缘防火墙



###  8.Internet 上的音视频

#### 在 internet 上传输音视频面临的问题

音视频占用的带宽高，需要网速恒定，延迟低。

延迟对于非交互的音视频影响不大
用缓存的方式解决带宽不稳定的问题

#### internet提供的音视频服务在技术上可以分为三种类型

1. 流式(streaming)存储音视频 —— 边下载边播
   节省客户端硬盘空间，不用下载
   保护视频版权
2. 流式，实况音视频—— 边录制边发送(直播)
   通过网络直播
3. 交互式音视频— — 实时交互式通信(qq 聊天)



#### IP 电话概述

狭义的 IP 电话：就是指在 IP 网络上打电话。所谓"ip 网络"就是"使用 ip 协议的分组交换网"的简称。

广义的 IP 电话：不仅仅是电话通信，而且还可以是在 IP 网络上进行交互式多媒体实时通信(包括语音、视频等)，甚至还包括即时通信 IM(Istant Messaging)。

#### IP 电话网关的几种连接方式

1. pc 到 pc
   pc ——intennet — — pc
2. pc 到固定电话机
    pc —— Internet —— ip 电话网关—— 公用电话网—— 固定电话机
3. 固定电话机到固定电话机
   固定电话机 —（电路交换）—  公用电话网 —— ip 电话网关 —（分组交换）— Internet —（分组交换）— ip 电话网关 —— 公用电话网 —（电路交换）— 固定电话机

#### QoS (改进网络层对数据的交付能力的服务)

1. 标记数据包，区分优先级
2. 路由器根据某些准则(例如，根据发送数据的地址)对输入分组进行分类，然后根据不同类别的通信量给予不同的优先级
3. 路由器应能将对数据流进行通信量的管制，使用该数据流不影响其他正常数据流在网络中通过
4. 在路由器中增加调度机制。利用调度功能给实时音频分配更高的带宽
5. 呼叫接纳：当已经有一个需要较高带宽的数据流通过时，阻止其他较高带宽数据流通过。数据流预先声明所需的服务质量，然后或者被准许进入网络，或者被拒绝进入网络







###  命令




| cmd 命令 | 详情 |
|---|---|
| netstat -n | 查看网络请求的会话的状态(如：浏览器访问网页) |
|netstat -nb |查看网络请求的会话的状态及名称 |
| nslookup | 查看提供域名服务的 DNS 服务器|
| ipconfig /release | 释放DHCP 的租约 |
|ipconfig /renew |重新申请 ip 地址 |
|ipconfig /all |查看网络配置信息 |
|net user administrator 123 | 更改用户密码 |
|net user miao 123 /add |添加用户 |
|ipconfig /flushdns |清除 dns 缓存 |
|shutdown -m \\\192.168.1.11 -r |重启远程计算机|
|arp -a| 查看计算机缓存的 IP 地址对应的 MAC 地址 |
|arp -s IP 地址 mac 地址|修改计算机的 mac 地址|
|route print| 查看计算机路由表|
|pathping ip 地址|跟踪网络路径|
|运行命令 | |
| msconfig |打开系统配置 |
| mmc|微软管理控制台-查看证书 |